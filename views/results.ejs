<!DOCTYPE html>
<html lang="<%= locale %>">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= __('Property Search Results') %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
  <style>
    body {
      background: #f6f8fb;
    }
    .navbar {
      border-radius: 20px;
      margin: 24px 0 16px 0;
      box-shadow: 0 4px 24px rgba(0,0,0,0.04);
      background: #fff;
    }
    .search-bar {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
      padding: 24px;
      margin-bottom: 24px;
    }
    .map-section {
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 16px;
      margin-bottom: 32px;
    }
    #map {
      height: 350px;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }
    .property-cards {
      display: flex;
      gap: 24px;
      overflow-x: auto;
      padding-bottom: 16px;
    }
    .property-card {
      min-width: 320px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 0;
      margin-bottom: 16px;
      border: none;
    }
    .property-card img {
      border-radius: 18px 18px 0 0;
      width: 100%;
      height: 180px;
      object-fit: cover;
    }
    .property-card .card-body {
      padding: 18px 18px 12px 18px;
    }
    .tag {
      position: absolute;
      top: 16px;
      left: 16px;
      background: #ffb366;
      color: #fff;
      font-size: 0.85rem;
      padding: 4px 12px;
      border-radius: 8px;
      font-weight: 600;
    }
    .tag.rent {
      background: #000000;
    }
    .property-meta {
      font-size: 0.95rem;
      color: #6c757d;
      margin-top: 8px;
    }
    .property-features {
      display: flex;
      gap: 16px;
      font-size: 0.9rem;
      color: #6c757d;
      margin-top: 8px;
    }
    .profile-pic {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg px-4 py-2">
    <a class="navbar-brand fw-bold" href="/"><%= __('NPSP') %></a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav mx-auto">
        <!-- <li class="nav-item"><a class="nav-link active" href="#"><%= __('Find Home') %></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><%= __('Product') %></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><%= __('Services') %></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><%= __('About Us') %></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><%= __('News') %></a></li> -->
      </ul>
      <div class="d-flex align-items-center gap-3">
        <img src="https://i.postimg.cc/PxTybjYS/b7xwuj.jpg" class="profile-pic" alt="<%= __('Profile') %>">
        <span class="fw-semibold"><%= __('Hi') %>, <%= results[0].ownerName %></span>
      </div>
    </div>
  </nav>

  <!-- Results Count & Sort -->
  <div class="container d-flex justify-content-between align-items-center mb-3">
    <div>
      <span class="fs-3 fw-bold text-primary"><%= results.length %></span>
      <span class="fs-5"><%= __('Result Found') %></span>
      <% if (results.length > 0) { %>
        <div class="text-muted"><%= __('In') %> <%= results[0].cityOrVillage %>, <%= results[0].district %></div>
      <% } else { %>
        <div class="text-muted"><%= __('No location found') %></div>
      <% } %>
    </div>
  </div>

  <!-- Map Section -->
  <div class="container map-section mb-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div>
        <button class="btn btn-primary btn-sm me-2"><%= __('Map') %></button>
      </div>
      <div>
        <button class="btn btn-light btn-sm"><i class="bi bi-arrows-fullscreen"></i></button>
      </div>
    </div>
    <div id="map"></div>
  </div>

  <!-- Property Cards -->
  <div class="container property-cards mb-5">
    <% results.forEach((property, index) => { %>
      <div class="card property-card position-relative">
        <img src="<%= results[0].imageUrl || '/images/default-house.jpg' %>" 
             alt="<%= __('Property Image') %>"
             onerror="this.src='https://5.imimg.com/data5/SELLER/Default/2021/3/KO/QG/XG/3922575/luxury-bungalow-design-500x500.jpg'">
        <div class="card-body">
          <div class="fw-semibold mb-1"><%= property.name || property.ownerName %></div>
          <div class="property-meta"><%= property.address %></div>
          <div class="property-features">
            <span>Sqr feet : <%= results[0].squareFeet || 'Data Not Available'  %></span>
            <span><%= property.bathrooms || '2' %> <%= __('Bathrooms') %></span>
            <span><%= property.bedrooms || '4' %> <%= __('Bedrooms') %></span>
          </div>
        </div>
      </div>
    <% }); %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize map
      const map = L.map('map');
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);
      const markerCounts = {};
      const markers = [];
      <% results.forEach((property, index) => { %>
          (function() {
            let lat = parseFloat("<%= property.latitude %>");
            let lng = parseFloat("<%= property.longitude %>");
            const key = lat.toFixed(6) + "_" + lng.toFixed(6);
            let count = markerCounts[key] || 0;
            if(count > 0) {
              lat += count * 0.0001;
              lng += count * 0.0001;
            }
            markerCounts[key] = count + 1;
            const marker = L.marker([lat, lng])
              .bindPopup(`
                  <div class="popup-content">
                      <h3>${'<%= property.ownerName %>'}</h3>
                      <p><strong><%= __('Property ID') %>:</strong> ${'<%= property.propertyId %>'}</p>
                      <p><strong><%= __('Registration') %>:</strong> ${'<%= property.registrationNumber %>'}</p>
                      <p><strong><%= __('Location') %>:</strong> ${'<%= property.address %>'}</p>
                      <p><strong><%= __('Coordinates') %>:</strong> ${lat.toFixed(4)}, ${lng.toFixed(4)}</p>
                  </div>
              `);
            markers.push(marker);
            marker.addTo(map);
          })();
      <% }); %>
      if (markers.length > 0) {
          const group = new L.featureGroup(markers);
          const bounds = group.getBounds();
          if (bounds.isValid() && bounds.getNorthEast().equals(bounds.getSouthWest())) {
              map.setView(bounds.getCenter(), 15);
          } else {
              map.fitBounds(bounds.pad(0.1));
          }
      }
    });
  </script>
</body>
</html>
